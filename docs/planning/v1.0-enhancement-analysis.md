# token-audit v1.0 Feature Enhancement Analysis for v1.x → v2.0

**Date**: December 14, 2025
**Purpose**: Identify which v1.0 features need substantial updates based on market trends, MCP ecosystem evolution, and enterprise requirements

---

## Executive Summary

Based on comprehensive analysis of token-audit's 19 core modules and 41+ capabilities against December 2025 market trends, **8 major feature areas** require substantial enhancement to remain competitive and address emerging needs in the MCP ecosystem.

The key drivers for enhancement are:
1. **MCP Security Crisis** - "The S in MCP stands for security" reflects real vulnerabilities (CVE-2025-6515, CVE-2025-6514)
2. **Platform Fragmentation** - 10+ major AI coding tools vs token-audit's 3 platforms
3. **Enterprise Adoption** - 28% of Fortune 500 using MCP; governance/cost tracking critical
4. **Vibecoding Mainstream** - 82% of developers use AI assistants daily; 25% of YC startups 95% AI-generated
5. **AAIF Governance** - MCP donated to Linux Foundation; goose + AGENTS.md now co-standards

---

## Feature Enhancement Matrix

### Priority Levels
- **P0**: Critical - blocks v2.0 viability
- **P1**: High - major market differentiator
- **P2**: Medium - valuable enhancement
- **P3**: Low - nice to have

---

## 1. Platform Adapters (P0 - Critical Enhancement)

### Current State (v1.0)
- `claude_code_adapter.py` - Claude Code CLI
- `codex_cli_adapter.py` - OpenAI Codex CLI
- `gemini_cli_adapter.py` - Google Gemini CLI
- 3 platforms supported

### Why Enhancement Needed

**Market Reality (Dec 2025):**
- **Cursor** - Market leader in AI IDEs, dominant adoption
- **goose** - AAIF founding project, 24.3k GitHub stars, MCP-native
- **Cline** - 2M+ VS Code installs, open source
- **Windsurf** - Major Cursor competitor
- **Aider** - Popular open source CLI (2.5k+ stars)
- **Continue.dev** - Open source, multi-model
- **Devin**, **Amazon Q**, **JetBrains AI** - Enterprise players

**Research Findings:**
- "The best AI developer tools in 2025 are Aider, Cursor, Zed, Claude Code, Windsurf, and Github Copilot" - PragmaticCoders
- 82% of developers use AI coding assistants daily/weekly (DORA 2025)
- Platform comparison is top requested feature

### Enhancement Plan (v1.2.0 - v1.4.0)

| Version | Adapter | Priority | Rationale |
|---------|---------|----------|-----------|
| v1.2.0 | **goose** | P0 | AAIF reference runtime, MCP-native |
| v1.2.0 | **Cursor** | P0 | Market leader, high demand |
| v1.4.0 | **Cline** | P1 | VS Code ecosystem, open source |
| v1.4.0 | **Aider** | P1 | Popular CLI, accessible format |
| v2.0.0 | **Plugin Architecture** | P0 | Community adapters |

### Files to Modify
- `src/token_audit/goose_adapter.py` (new)
- `src/token_audit/cursor_adapter.py` (new)
- `src/token_audit/cline_adapter.py` (new)
- `src/token_audit/aider_adapter.py` (new)
- `src/token_audit/base_tracker.py` (adapter registration)
- `src/token_audit/cli.py` (platform detection)

---

## 2. Security Analysis Layer (P0 - New Feature Required)

### Current State (v1.0)
- **No security features exist**
- Smell detection focuses on efficiency only (12 patterns)
- No tool poisoning detection
- No prompt injection analysis
- No credential exposure scanning

### Why Enhancement Needed

**MCP Security Crisis (2025):**

| Vulnerability | CVE/Source | Severity |
|--------------|------------|----------|
| Tool Poisoning | Invariant Labs (Apr 2025) | Critical |
| Prompt Injection | CVE-2025-6515 | Critical |
| OAuth RCE | CVE-2025-6514 (mcp-remote) | Critical |
| Credential Exposure | Knostic (1,800 unauth servers) | High |
| Cross-Server Shadowing | Snyk Toxic Flow | High |

**Research Findings:**
- "The joke 'The S in MCP stands for security' reflects real vulnerabilities" - dreamy-hugging-wave.md
- 88% of MCP servers require credentials; 53% use insecure long-lived tokens (Astrix)
- Security tooling emerging: MCP-scan, MCPTox, MindGuard, Enkrypt Gateway

**Market Opportunity:**
- token-audit is uniquely positioned: has tool call data, can analyze patterns
- No existing audit tool provides security analysis
- Enterprise adoption blocked by security concerns

### Enhancement Plan (v1.5.0 - v1.8.0)

| Version | Feature | Priority | Description |
|---------|---------|----------|-------------|
| v1.5.0 | **Security Research** | P0 | Evaluate MCP-scan integration vs custom |
| v1.5.0 | **Tool Description Scanner** | P0 | Flag suspicious tool descriptions |
| v1.8.0 | **Toxic Flow Analysis** | P1 | Map data exfiltration risks |
| v1.8.0 | **Security Posture Score** | P1 | Per-session security rating |
| v1.8.0 | **Credential Exposure Detection** | P1 | Identify plaintext credentials |

### Files to Modify/Create
- `src/token_audit/security/` (new directory)
- `src/token_audit/security/tool_scanner.py` (new)
- `src/token_audit/security/toxic_flow.py` (new)
- `src/token_audit/security/credential_detector.py` (new)
- `src/token_audit/smells.py` (add security smell patterns)
- Schema v2.0: Add `security` block

---

## 3. Token Estimator (P1 - Enhancement)

### Current State (v1.0)
- `token_estimator.py` - TikToken + SentencePiece
- Supports Claude (native), Codex (tiktoken o200k_base), Gemini (Gemma)
- 15+ model encodings mapped
- FUNCTION_CALL_OVERHEAD: 25 tokens

### Why Enhancement Needed

**New Model Landscape (2025):**
- **Reasoning tokens** tracked separately (o-series, Gemini 2.0+ thoughts)
- **GPT-5 series** - new tokenizer requirements
- **Claude Opus 4.5** - thinking tokens (not exposed but may change)
- **Local models** (Ollama, vLLM) - diverse tokenizers
- **Devstral 2** (Mistral) - 123B parameter coding model

**Research Findings:**
- Schema v1.3.0 added `reasoning_tokens` but only basic support
- Ollama CLI deferred to v1.1.0 due to API proxy complexity
- Multi-model sessions increasingly common (switching mid-session)

### Enhancement Plan (v1.0.4 - v1.2.0)

| Version | Feature | Priority | Description |
|---------|---------|----------|-------------|
| v1.4.0 | **Ollama Tokenizer** | P1 | Local model token estimation |
| v1.3.0 | **Context Window Tracking** | P1 | Per-turn token load |
| v1.3.0 | **Reasoning Token Deep Tracking** | P2 | Breakdown by thinking step |
| v1.6.0 | **Schema Tokenizer** | P2 | Full MCP schema token counting |

### Files to Modify
- `src/token_audit/token_estimator.py` (add Ollama support)
- `src/token_audit/ollama_adapter.py` (new)
- `src/token_audit/base_tracker.py` (context window tracking)

---

## 4. Pricing Configuration (P1 - Enhancement)

### Current State (v1.0)
- `pricing_config.py` - TOML-based with LiteLLM API fallback
- `pricing_api.py` - LiteLLM dynamic pricing (2,000+ models)
- 24-hour cache, graceful fallback
- 26+ models with input/output/cache rates

### Why Enhancement Needed

**Enterprise Cost Tracking (2025):**
- Average org spends **$85,521/month** on AI-native applications (CloudZero)
- 40-60 minutes saved/day per developer (OpenAI Enterprise Report)
- Need for **per-team/project cost allocation**
- Need for **budget alerts and thresholds**

**Research Findings:**
- "Most AI tools provide admin APIs for tracking usage, token consumption, and spending" - DX
- Enterprise needs: governance reports, cost allocation, trend analysis
- Moesif, nOps, CloudZero emerging as GenAI cost optimization tools

### Enhancement Plan (v1.3.0 - v2.0.0)

| Version | Feature | Priority | Description |
|---------|---------|----------|-------------|
| v1.3.0 | **Cost Budgets** | P2 | Per-project budget tracking |
| v1.7.0 | **Cost Threshold Alerts** | P2 | Notify when limits exceeded |
| v2.0.0 | **Team Cost Allocation** | P1 | Multi-user cost aggregation |
| v2.0.0 | **Enterprise Pricing APIs** | P2 | Integrate with FinOps tools |

### Files to Modify
- `src/token_audit/pricing_config.py` (budgets, thresholds)
- `src/token_audit/pricing_api.py` (enterprise integrations)
- `src/token_audit/cli.py` (budget commands)

---

## 5. Smell Detection Engine (P1 - Enhancement)

### Current State (v1.0)
- `smells.py` - 12 efficiency anti-patterns
- `recommendations.py` - 4 recommendation types
- `smell_aggregator.py` - Cross-session analysis
- Focus: efficiency only (no security, no governance)

### Why Enhancement Needed

**Missing Smell Categories:**

| Category | Current | Needed |
|----------|---------|--------|
| Efficiency | 12 patterns | ✅ Good |
| Security | 0 patterns | ❌ Critical gap |
| Governance | 0 patterns | ❌ Enterprise need |
| Cost | 0 patterns | ❌ Budget awareness |

**Research Findings:**
- Security smells: suspicious tool descriptions, unusual data flows, credential patterns
- Governance smells: compliance violations, unauthorized tool access
- Cost smells: runaway sessions, inefficient model selection

### Enhancement Plan (v1.5.0 - v1.8.0)

| Version | Feature | Priority | Description |
|---------|---------|----------|-------------|
| v1.5.0 | **Security Smells** (5 new) | P0 | SUSPICIOUS_DESCRIPTION, EXFILTRATION_RISK, etc. |
| v1.8.0 | **Cost Smells** (3 new) | P2 | BUDGET_EXCEEDED, INEFFICIENT_MODEL, RUNAWAY_SESSION |
| v2.0.0 | **Governance Smells** (3 new) | P2 | UNAUTHORIZED_TOOL, COMPLIANCE_VIOLATION |

### Files to Modify
- `src/token_audit/smells.py` (add security/cost/governance patterns)
- `src/token_audit/recommendations.py` (security recommendations)
- `src/token_audit/smell_aggregator.py` (cross-category aggregation)

---

## 6. Storage & Session Management (P2 - Enhancement)

### Current State (v1.0)
- `storage.py` - JSONL storage, local filesystem
- `session_manager.py` - Single-user, single-machine
- Directory: `~/.token-audit/sessions/<platform>/<date>/`
- No remote storage, no multi-user aggregation

### Why Enhancement Needed

**Enterprise Requirements:**
- Team-wide usage analytics
- Cross-machine session aggregation
- Remote storage backends (S3, GCS, cloud databases)
- Governance-ready audit exports

**Research Findings:**
- New Relic MCP Server, Cloudflare MCP Gateway emerging for enterprise
- Organizations need centralized MCP observability
- Vibecoding governance concerns require audit trails

### Enhancement Plan (v2.0.0)

| Version | Feature | Priority | Description |
|---------|---------|----------|-------------|
| v2.0.0 | **Multi-User Aggregation** | P1 | Team-wide analytics |
| v2.0.0 | **Remote Storage Backends** | P2 | S3, GCS, databases |
| v2.0.0 | **Governance Export Formats** | P1 | SOC2, compliance reports |
| v2.0.0 | **MCP Gateway Integration** | P2 | Cloudflare, TrueFoundry |

### Files to Modify
- `src/token_audit/storage.py` (pluggable backends)
- `src/token_audit/aggregation/` (new directory)
- `src/token_audit/export/governance.py` (new)

---

## 7. TUI & Display (P2 - Enhancement)

### Current State (v1.0)
- `display/rich_display.py` - Live TUI with Rich
- `display/session_browser.py` - Interactive browser
- 8 browser modes (LIST, DETAIL, SEARCH, COMPARISON, etc.)
- Catppuccin themes, ASCII mode

### Why Enhancement Needed

**Missing Visualization:**
- No security posture visualization
- No cross-platform comparison dashboard
- No cost trend visualization
- No real-time anomaly alerts

**Research Findings:**
- APIContext: "live resilience signal" for MCP performance
- Developers want at-a-glance health indicators
- Security alerts need visual prominence

### Enhancement Plan (v1.3.0 - v2.0.0)

| Version | Feature | Priority | Description |
|---------|---------|----------|-------------|
| v1.3.0 | **Tool Detail Mode** | P2 | Per-tool drill-down |
| v1.7.0 | **Platform Comparison Dashboard** | P1 | Claude vs Cursor vs Gemini |
| v1.8.0 | **Security Posture Panel** | P1 | Visual security indicators |
| v2.0.0 | **Cross-Platform Unified Dashboard** | P1 | Single view, all platforms |

### Files to Modify
- `src/token_audit/display/rich_display.py` (security panel)
- `src/token_audit/display/session_browser.py` (comparison mode)
- `src/token_audit/display/dashboard.py` (new)

---

## 8. Schema & Data Contract (P1 - Enhancement)

### Current State (v1.0)
- Schema v1.7.0 - backward compatible
- Blocks: `session`, `token_usage`, `smells`, `recommendations`, `data_quality`
- No security blocks
- No multi-platform metadata
- No governance/compliance fields

### Why Enhancement Needed

**v2.0 Breaking Changes Required:**
- Security analysis results need dedicated blocks
- Multi-platform comparison needs unified metadata
- Enterprise compliance requires audit fields
- AAIF spec tracking requires version metadata

### Enhancement Plan (v2.0.0)

| Feature | Description |
|---------|-------------|
| **`security` block** | Tool description analysis, toxic flow results, posture score |
| **`platform_metadata` block** | Unified fields for cross-platform comparison |
| **`governance` block** | Compliance status, audit trail, retention policy |
| **`aaif_compliance` block** | MCP spec version, goose compatibility |

### Files to Modify
- `src/token_audit/base_tracker.py` (new dataclasses)
- `docs/data-contract.md` (v2.0 schema)
- `schema/session-v2.0.0.json` (new)

---

## Summary: Enhancement Roadmap by Version

### v1.4.0 — Local Models
- Ollama CLI adapter (token estimation via proxy)
- Zero-cost session tracking

### v1.2.0 — Platform Expansion
- **goose adapter** (AAIF, P0)
- **Cursor adapter** (market leader, P0)
- AGENTS.md parsing

### v1.3.0 — Developer Insight
- Context window tracking
- Cost budgets
- TUI Tool Detail mode

### v1.4.0 — IDE Extensions
- **Cline adapter** (VS Code, P1)
- **Aider adapter** (CLI, P1)

### v1.5.0 — Security Research
- Evaluate MCP-scan integration
- Tool description security scanning (P0)
- 5 new security smell patterns

### v1.6.0 — Payload Analysis
- Schema tokenizer
- Dynamic payload heatmap
- Description density scoring

### v1.7.0 — Cross-Platform Analysis
- Platform efficiency comparison (P1)
- Baseline session support
- Cost threshold alerts

### v1.8.0 — Security Implementation
- Toxic flow analysis
- Security posture scoring (P1)
- Credential exposure detection

### v1.9.0 — Comparison Suite
- Session drift detection
- Enhanced TUI comparison mode
- Cross-session trend engine

### v2.0.0 — Enterprise Platform
- **Plugin architecture** (community adapters, P0)
- **Schema v2.0** (security blocks, breaking changes)
- **Cross-platform unified dashboard** (P1)
- **Team/enterprise features** (aggregation, governance)
- **AAIF compliance verification**

---

## Key Research Sources

### MCP Ecosystem
- MCP Blog: November 2025 Spec Release
- TechCrunch: Google managed MCP servers (Dec 2025)
- The New Stack: "Why the Model Context Protocol Won"
- AAIF founding projects: goose, AGENTS.md

### Security
- Invariant Labs: Tool Poisoning Attacks (Apr 2025)
- CVE-2025-6515: Prompt Hijacking
- CVE-2025-6514: mcp-remote RCE
- Astrix: State of MCP Server Security 2025

### Market Trends
- DORA Report 2025: 95% of developers use AI tools
- OpenAI Enterprise AI Report: 40-60 min/day saved
- Y Combinator: 25% of startups 95% AI-generated
- Collins Dictionary: "Vibe coding" Word of the Year 2025

### Enterprise
- CloudZero: $85,521/month average AI spend
- Menlo Ventures: $550M → $4B AI coding market (2025)
- DX: AI measurement and cost tracking

---

## Decisions Made (User Confirmed)

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Priority ordering** | ✅ Confirmed | P0: Platform + Security, P1: Token/Pricing/Smells, P2: Storage/TUI |
| **Security approach** | Hybrid | Research MCP-scan AND custom smells in v1.5.0, decide based on findings |

## Next Steps

1. ~~Validate with user: Confirm priority ordering~~ ✅ Done
2. ✅ **Create backlog tasks**: v1.2.0 platform expansion (goose, Cursor)
3. ✅ **Update ROADMAP.md**: Incorporate security focus from v1.5.0
4. **Begin goose research**: Session format, log locations
5. **Security research task**: Evaluate MCP-scan vs custom patterns

---

**This analysis identifies 8 major feature areas requiring substantial enhancement, with security analysis (P0) and platform expansion (P0) as the most critical gaps between token-audit v1.0 and market requirements.**
